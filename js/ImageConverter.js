//ImageConverter.js
//Created by Torisima 2025
//License : https://github.com/Dev-Torisima/Imqutive-Codes/blob/main/LICENSE

const ToBitmap_Const1 = new Uint8Array([0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,     0xff,0x00,0x00,0x00,   0x00,0xff,0x00,0x00,   0x00,0x00,0xff,0x00,   0x00,0x00,0x00,0xff,    0x42, 0x47, 0x52, 0x73,  
    0x00,0x00,0x00,0x00,0x00,0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]);
const ToBitmap_Const2 = new Uint8Array([0x42, 0x4d]);
const ToBitmap_Const3 = new Uint8Array([0x00, 0x00, 0x00, 0x00]);
const ToBitmap_Const4 = new Uint8Array([0x7c, 0x00, 0x00, 0x00]);
const ToBitmap_Const5 = new Uint8Array([0x01, 0x00, 0x20, 0x00, 0x03, 0x00, 0x00, 0x00]);

function ToBitmap(l3)
{
    let l2 = new Uint8Array(l3.data.buffer);
let l1 = new Uint8Array(14 + 0x7c + l2.length);
let rl = 0;

//File Header
l1.set(ToBitmap_Const2, 0);
l1.set(ToBytes_u32(14 + 0x7c + l2.length), rl + 2);
l1.set(ToBitmap_Const3, rl + 6);
l1.set(ToBytes_u32(14 + 0x7c), rl + 10);
rl += 14;

//Info Header(V5)
l1.set(ToBitmap_Const4, rl);
l1.set(ToBytes_u32(l3.width), rl + 4);
l1.set(ToBytes_i32(-l3.height), rl + 8);
l1.set(ToBitmap_Const5, rl + 12);
l1.set(ToBytes_u32(l2.length), rl + 20);
l1.set(ToBitmap_Const1, rl + 24);
rl += 0x7c;

//ImageData
l1.set(l2, rl);

return l1;
}

function ToBytes_i32(num)
{
let l31 = new DataView(new ArrayBuffer(4));
l31.setInt32(0, num, true);
return new Uint8Array(l31.buffer);
}

function ToBytes_u32(num)
{
let l31 = new DataView(new ArrayBuffer(4));
l31.setUint32(0, num, true);
return new Uint8Array(l31.buffer);
}
